## 请求代理服务器--加密

**代理服务器：** 提供代理服务的电脑系统或其它类型的网络终端,代替网络用户去取得网络信息。

使用代理的**主要目的：**

- 缓存：提高访问速度，由于目标主机返回的数据会存放在代理服务器的硬盘中，因此下一次客户再访问相同的站点数据时，会直接从代理服务器的硬盘中读取，起到缓存的作用，尤其对于热门网站能明显提高访问速度。

- 网络访问控制：防火墙作用，由于所有的客户机请求都必须通过代理服务器访问远程站点，因此可以在代理服务器上设限，过滤掉某些不安全信息。同时正向代理中上网者可以隐藏自己的IP,免受攻击。

- 突破访问限制：互联网上有许多开发的代理服务器，客户机在访问受限时，可通过不受限的代理服务器访问目标站点，通俗说，我们使用的翻墙浏览器就是利用了代理服务器，可以直接访问外网。

- 负载均衡，通过配置后台各个服务器的权重参数，实现多机负载

  

#### **正向代理的应用**

1. 访问原来无法访问的资源

2. 用作缓存，加速访问速度

3. 对客户端访问授权，上网进行认证

4. 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

#### **反向代理的应用**

1. 保护内网安全
2. 负载均衡
3. 缓存，减少服务器的压力



**正向代理：**一个位于客户端和原始服务器之间的服务器，为了从 **原始服务器取得内容**，客户端向代理发送一个请求并制定目标（原始服务器），然后 **代理向原始服务器转发请求**并将获得的内容返回给客户端，客户端才能使用正向代理。我们平时说的代理就是指正向代理。

<img src="https://tva1.sinaimg.cn/large/008i3skNly1guru2sm4zxj60i907mwem02.jpg" alt="img" width="450" height="200"  />

**反向代理：**以 **代理服务器来接受internet上的连接请求**，然后 将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求的客户端，此时代理服务器对外表现为一个反向代理服务器。

<img src="https://tva1.sinaimg.cn/large/008i3skNly1guru2psrynj60ec076mx702.jpg" alt="img" width="450" height="200"  />

#### 正向/反向区别：

**1.位置不同**

- 正向代理，架设在客户机和目标主机之间；

- 反向代理，架设在服务器端；


**2.代理对象不同**

- 正向代理，代理客户端，服务端不知道实际发起请求的客户端；

- 反向代理，代理服务端，客户端不知道实际提供服务的服务端；

**3.安全性不同**

- 正向代理允许客户端通过它访问任意网站并且隐藏客户端自身，因此必须采取安全措施以确保仅为授权的客户端提供服务；
- 反向代理都对外都是透明的，访问者并不知道自己访问的是哪一个代理。






### 加密技术:

是对信息进行编码和解码的技术，编码是把原来可读信息（明文）译成代码形式（密文），其逆过程就是解码（解密），加密技术要点是加密算法，加密算法可分为三类：

#### 对称加密，如AES：

​    基本原理：将明文分成N个组，然后使用密钥对各个组进行加密，形成各自的密文，最后把所有的分组密文进行合并，形成最终的密文。
​    优势：算法公开、计算量小、加密速度快、加密效率高
​    缺陷：双方都使用 同样密钥，安全性得不到保证

#### 非对称加密，如RSA：

​    基本原理：同时生成两把密钥：私钥和公钥，私钥隐秘保存，公钥可以下发给信任客户端
​    私钥加密，持有 私钥、公钥才可以解密
​    公钥加密，持有 私钥才可解密
​    优点：安全，难以破解
​    缺点：算法比较耗时

#### 不可逆加密，如MD5，SHA：

​    基本原理：加密过程中不需要使用密钥，输入明文后由系统直接经过加密算法处理成密文，这种加密后的数据是无法被解密的，无法根据密文推算出明文。



#### 1.在没有RSA加密时：

在微服务架构中，可以把服务的鉴权操作放到网关中，将未通过鉴权的请求直接拦截，如图：

<img src="https://tva1.sinaimg.cn/large/008i3skNly1guru1r5iujj60mi0fc75902.jpg" alt="1527312464328" width="650" height="400"  />

1.用户请求登录
2.Zuul将请求转发到授权中心，请求授权
3.授权中心校验完成，颁发JWT凭证
4.客户端请求其它功能，携带JWT
5.Zuul将jwt交给授权中心校验，通过后放行
6.用户请求到达微服务
7.微服务将jwt交给鉴权中心，鉴权同时解析用户信息
8.鉴权中心返回用户数据给微服务
9.微服务处理请求，返回响应
问题： 每次鉴权都需要访问鉴权中心，系统间的网络请求频率过高，效率略差，鉴权中心的压力较大。

#### 2.在结合RSA的鉴权：

<img src="https://tva1.sinaimg.cn/large/008i3skNly1guru2cq63ej60ma0ezt9t02.jpg" alt="1527313765010" width="650" height="400"  />

1.利用RSA生成公钥和私钥，私钥保存在授权中心，公钥保存在Zuul和各个信任的微服务
2.用户请求登录
3.授权中心校验，通过后用私钥对JWT进行签名加密
4.返回jwt给用户
5.用户携带JWT访问
6.Zuul直接通过 公钥解密 JWT，进行验证，验证通过则放行
7.请求到达微服务，微服务直接用公钥解析JWT，获取用户信息，无需访问授权中心



